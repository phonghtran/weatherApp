var currentLocation={longitude:-73.949577,latitude:40.650101,colorSpectrum:['#1A237E','#7986CB']},defaultLocations={brooklyn:{name:'brooklyn',id:5110302,preferredCard:'cardBrooklyn',longitude:-73.949577,latitude:40.650101,colorSpectrum:['#1A237E','#7986CB'],coverImage:'https://untappedcities-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/2_The-Top-10-Secrets-of-Downtown-Brooklyn-in-NYC_Brooklyn-Bridge_Sunset_NYC_Untapped-Cities.v1.jpg'},tokyo:{name:'tokyo',id:1850147,preferredCard:'cardTokyo',longitude:139.691711,latitude:35.689499,colorSpectrum:['#BF360C','#F4511E'],coverImage:'https://www.telegraph.co.uk/content/dam/Travel/Destinations/Asia/Japan/Tokyo/Tokyo%20lead-xlarge.jpg'},santaMonica:{name:'santaMonica',id:5393212,preferredCard:'cardSantaMonica',longitude:-118.491188,latitude:34.019451,colorSpectrum:['#B71C1C','#EF5350'],coverImage:'https://www.santamonica.com/wp-content/uploads/2015/04/thumbnail_pier2.jpg'},amsterdam:{name:'amsterdam',id:2759794,preferredCard:'cardAmsterdam',longitude:4.88969,latitude:52.374031,colorSpectrum:['#880E4F','#EC407A'],coverImage:'http://www.netherlands-tourism.com/wp-content/uploads/2014/11/Amsterdam.jpg'},honolulu:{name:'honolulu',id:5856195,preferredCard:'cardHonolulu',longitude:-157.858337,latitude:21.30694,colorSpectrum:['#4a148c','#BA68C8'],coverImage:'https://travel.usnews.com/static-travel/images/destinations/59/waikiki_beach_honolulu.jpg'}},wW=1024,wH=768,cW=1024,cH=768,canvasAspectRatio=1.33,canvasObjectStorage={};$(document).ready(function(){for(city in $(window).resize(function(){wW=$(window).width(),wH=$(window).height(),700<wW?(canvasAspectRatio=3,$('#searchToggle').attr('disabled',!0)):$('#searchToggle').attr('disabled',!1),cW=$('#cardHolder').width(),cH=cW/canvasAspectRatio}).resize(),defaultLocations)getWeatherData(defaultLocations[city]);$('#searchToggle').on('click',function(a){if(a.preventDefault(),$('body').toggleClass('searchMode'),$('body').hasClass('searchMode'))for(city in defaultLocations)parseWeather(defaultLocations[city].name);else window.requestAnimationFrame(function(){renderAnimation()})}),$('li.card').on('click',function(a){if(a.preventDefault(),$('body').hasClass('searchMode')||700<wW){var b=$('#cardBrooklyn').attr('city');parseWeather($(this).attr('city'),'cardBrooklyn'),parseWeather(b,$(this).attr('id')),$('body').removeClass('searchMode')}})});function setupAnimation(a){var b=parseInt(a.weatherId/100);switch(canvasObjectStorage={},b){case 2:for(var c=0;2>c;c++){canvasObjectStorage[c]={},canvasObjectStorage[c].image=new Image,canvasObjectStorage[c].image.src=prepSVGPathForCanvas(vectors.thunder);var d=0.8*(cH/vectors.thunder.height);canvasObjectStorage[c].viewBox={x:0,y:0,w:vectors.thunder.width,h:vectors.thunder.height},canvasObjectStorage[c].targetViewBow={x:cW-1.1*(vectors.thunder.width*d),y:0,w:vectors.thunder.width*d,h:vectors.thunder.height*d},0==c&&(canvasObjectStorage[c].transformation={flash:!0})}break;case 3:case 5:case 6:for(var f=Math.floor(Math.random()*b)+2,g=2*Math.random()+1,h=6==b?vectors.snow:vectors.rain,c=0;c<=f;c++){canvasObjectStorage[c]={},canvasObjectStorage[c].image=new Image,canvasObjectStorage[c].image.src=prepSVGPathForCanvas(h,{'path,polygon':{fill:'rgba(255, 255, 255, '+(0.25*Math.random()+0.1).toFixed(2)+')'}});var j=c==f?0.3*cH:0.2*Math.random()*cH+0.2*cH;canvasObjectStorage[c].viewBox={x:0,y:0,w:h.width,h:h.height},canvasObjectStorage[c].targetViewBow={x:c==f?0.6*cW:1.15*(Math.random()*cW)-0.15*cW,y:c==f?0.35*cH:Math.random()*cH-0.15*cH,w:j,h:j},canvasObjectStorage[c].transformation={add:{y:0.05*(g*Math.random())+0.97*g}}}break;case 7:for(var c=0;20>c;c++){canvasObjectStorage[c]={},canvasObjectStorage[c].image=new Image,canvasObjectStorage[c].image.src=prepSVGPathForCanvas(vectors.atmosphereBar,{'#bar':{fill:'rgba(255, 255, 255, '+(0.25*Math.random()+0.05).toFixed(2)+')'}});var d=cW/vectors.atmosphereBar.width;canvasObjectStorage[c].viewBox={x:0,y:0,w:vectors.atmosphereBar.width,h:vectors.atmosphereBar.height},canvasObjectStorage[c].targetViewBow={x:0,y:cH-0.08*cH*c,w:cW,h:0.2*cH*Math.random()},canvasObjectStorage[c].transformation={opacity:{current:Math.random(),step:-0.01*Math.random(),min:0,max:0.5}}}break;case 8:if(800==a.weatherId){var c=0,h=a.isNight?vectors.moon:vectors.sun;canvasObjectStorage[c]={},canvasObjectStorage[c].image=new Image,canvasObjectStorage[c].image.src=prepSVGPathForCanvas(h);var d=0.5*(cH/h.height);canvasObjectStorage[c].viewBox={x:0,y:0,w:h.width,h:h.height},canvasObjectStorage[c].targetViewBow={x:cW-1.2*(h.width*d),y:0.1*cH,w:h.width*d,h:h.height*d},canvasObjectStorage[c].transformation={opacity:{current:1,step:-1e-3,min:0.92,max:1}}}else for(var h,f=801==a.weatherId?1:5,c=0;c<=f;c++){h=vectors['cloud'+(Math.floor(3*Math.random())+1)],canvasObjectStorage[c]={},canvasObjectStorage[c].image=new Image,canvasObjectStorage[c].image.src=prepSVGPathForCanvas(h);var d=0.5*(cH/h.height);0<c&&(d=d*Math.random()+0.5),canvasObjectStorage[c].viewBox={x:0,y:0,w:h.width,h:h.height},canvasObjectStorage[c].targetViewBow={x:0==c?cW-1.2*(h.width*d):0.5*(cW*Math.random()),y:0==c?0.1*cH:cH*Math.random()-0.25*cH,w:h.width*d,h:h.height*d},canvasObjectStorage[c].transformation={add:{x:2*Math.random()}}}break;default:}window.requestAnimationFrame(function(){renderAnimation()})}function renderAnimation(){var a=$('.card.active canvas'),b=a[0].getContext('2d');for(object in b.clearRect(0,0,cW,cH),canvasObjectStorage){for(newTransform in canvasObjectStorage[object].transformation){if('add'==newTransform){for(propType in canvasObjectStorage[object].transformation[newTransform])canvasObjectStorage[object].targetViewBow[propType]+=canvasObjectStorage[object].transformation[newTransform][propType];canvasObjectStorage[object].targetViewBow.y>cH?canvasObjectStorage[object].targetViewBow.y=-1*canvasObjectStorage[object].targetViewBow.h:canvasObjectStorage[object].targetViewBow.y<-1*canvasObjectStorage[object].targetViewBow.h&&(canvasObjectStorage[object].targetViewBow.y=cH),canvasObjectStorage[object].targetViewBow.x>cW?canvasObjectStorage[object].targetViewBow.x=-1*canvasObjectStorage[object].targetViewBow.w:canvasObjectStorage[object].targetViewBow.x<-1*canvasObjectStorage[object].targetViewBow.w&&(canvasObjectStorage[object].targetViewBow.x=cW)}if('flash'==newTransform){var c=0.05>Math.random()?1.2*(cH/canvasObjectStorage[object].viewBox.h)*Math.random():0;canvasObjectStorage[object].targetViewBow={x:cW*Math.random(),y:0,w:canvasObjectStorage[object].viewBox.w*c,h:canvasObjectStorage[object].viewBox.h*c}}'opacity'==newTransform&&(canvasObjectStorage[object].transformation[newTransform].current+=canvasObjectStorage[object].transformation[newTransform].step,canvasObjectStorage[object].transformation[newTransform].current>canvasObjectStorage[object].transformation[newTransform].max?(canvasObjectStorage[object].transformation[newTransform].step*=-1,canvasObjectStorage[object].transformation[newTransform].current=canvasObjectStorage[object].transformation[newTransform].max):canvasObjectStorage[object].transformation[newTransform].current<canvasObjectStorage[object].transformation[newTransform].min&&(canvasObjectStorage[object].transformation[newTransform].step*=-1,canvasObjectStorage[object].transformation[newTransform].current=canvasObjectStorage[object].transformation[newTransform].min),b.globalAlpha=canvasObjectStorage[object].transformation[newTransform].current)}b.drawImage(canvasObjectStorage[object].image,canvasObjectStorage[object].viewBox.x,canvasObjectStorage[object].viewBox.y,canvasObjectStorage[object].viewBox.w,canvasObjectStorage[object].viewBox.h,canvasObjectStorage[object].targetViewBow.x,canvasObjectStorage[object].targetViewBow.y,canvasObjectStorage[object].targetViewBow.w,canvasObjectStorage[object].targetViewBow.h),b.globalAlpha=1}window.requestAnimationFrame(function(){$('body').hasClass('searchMode')||renderAnimation()})}function parseWeather(a,b){var j,c=cityWeatherInfo[a],d=c.city.name,f=0,g=0,h=1,k=!1,m='',n=new Rainbow,o={};for(var p in b=b||defaultLocations[a].preferredCard,n.setNumberRange(0,10),n.setSpectrum(defaultLocations[a].colorSpectrum[0],defaultLocations[a].colorSpectrum[1]),c.list){var q=c.list[p],r=new Date(1e3*q.dt),s={bgColor:'',classes:'',dateReadable:r.toString(),currentDay:r.getDay(),currentHour:r.getHours(),isNight:'',timestamp:'',currentTemp:Math.round(q.main.temp),weatherId:q.weather[0].id,weatherMain:q.weather[0].main,weatherDesc:q.weather[0].description};if(s.isNight=6<s.currentHour&&19>s.currentHour?!1:!0,0==f)j=s.currentDay,o={weatherId:s.weatherId,isNight:s.isNight},m='<div class="cardHeader"><h1>'+c.city.name+'</h1><span class="weather">'+findWeatherIcon(s)+'<span class=" weatherTemp">'+s.currentTemp+'<sup>\xB0</sup></span><h2 class="bigDesc">'+q.weather[0].description.replace(/\b\w/g,t=>t.toUpperCase())+'</h2></span></div>','cardBrooklyn'==b&&(m+='<canvas id="canvasCurrentCity" width="'+cW+'" height="'+cH+'" ></canvas><ul id="extendedForecast">'),g++;else if(5>f&&0<f)h=700<wW?3:h+1,s.bgColor='#'+n.colourAt(h),s.timestamp=prettyTime(s.currentHour),m+=generateExtendedForecastItem(s),g++;else if(j!=s.currentDay&&(k=!0,j=s.currentDay),!0==k&&12<=s.currentHour&&(h=700<wW?5:h+1,s.bgColor='#'+n.colourAt(h),s.timestamp=dayOfTheWeek(s.currentDay),m+=generateExtendedForecastItem(s),g++,k=!1,9==g))break;if(f++,'cardBrooklyn'!=b)break}'cardBrooklyn'==b&&(m+='</ul>'),$('#largeBgImage').css('backgroundImage','url("'+defaultLocations[a].coverImage+'")'),$('#'+b).html(m).css('background-color','#'+n.colourAt(0)).attr('city',a),'cardBrooklyn'==b&&setupAnimation(o)}function generateExtendedForecastItem(a){return'<li class="'+a.classes+'" style="background-color:'+a.bgColor+'"><div class="time">'+a.timestamp+'</div><div class="weather">'+findWeatherIcon(a)+'<span class="weatherTemp">'+a.currentTemp+'<sup>\xB0</sup> </span></div>'}function findWeatherIcon(a){var b='',c=parseInt(a.weatherId/100);switch(c){case 2:b+='thunder.png';break;case 3:case 5:b+='rain.png';break;case 6:b+='snow.png';break;case 7:b+='atmosphere.png';break;case 8:b+=800==a.weatherId?a.isNight?'clearN.png':'clear.png':801==a.weatherId?a.isNight?'partlyCloudyN.png':'partlyCloudy.png':'cloudy.png';break;default:b+=a.isNight?'clearN.png':'clear.png';}return'<img class="weatherIcon" src="img/'+b+'" alt="'+a.weatherDesc+'">'}function getWeatherData(a){$.ajax({method:'GET',url:'http://api.openweathermap.org/data/2.5/forecast',data:{id:a.id,mode:'json',APPID:'c5e0b01bf32a03207f66c5b14301fe45',units:'imperial'},success:function(b){200==b.cod&&(cityWeatherInfo[a.name]=b)},error:function(b){console.log('Error!'+b.status)},complete:function(){parseWeather(a.name,a.preferredCard)},dataType:'json'})}function geo_success(a){currentLocation.longitude=a.coords.longitude,currentLocation.latitude=a.coords.latitude,getWeatherData()}function geo_error(a){currentLocation=defaultLocations.Brooklyn,console.log('ERROR('+a.code+'): '+a.message),getWeatherData()}function dayOfTheWeek(a){return 0===a?'Sunday':1===a?'Monday':2===a?'Tuesday':3===a?'Wednesday':4===a?'Thursday':5===a?'Friday':6===a?'Saturday':void 0}function prettyTime(a){return 12>a?(0==a&&(a=12),a+'AM'):a-12+'PM'}function prepSVGPathForCanvas(a,b){var c='path, polygon { fill: rgba(255, 255, 255, 0.25); }';if('object'==typeof b)for(var d in b)if(b.hasOwnProperty(d)){for(var f in c+=d+'{',b[d])b[d].hasOwnProperty(f)&&(c+=f+':'+b[d][f]+';');c+='}'}return'data:image/svg+xml,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="'+a.width+'" height="'+a.height+'" viewBox="0 0 '+a.width+' '+a.height+'"><style type="text/css"><![CDATA[ '+c+'  ]]></style>'+a.path+'</svg>')}