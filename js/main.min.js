var currentLocation={longitude:-73.949577,latitude:40.650101,colorSpectrum:['#1A237E','#7986CB']},defaultLocations={brooklyn:{name:'brooklyn',id:5110302,preferredCard:'cardBrooklyn',longitude:-73.949577,latitude:40.650101,colorSpectrum:['#1A237E','#7986CB'],coverImage:'https://untappedcities-wpengine.netdna-ssl.com/wp-content/uploads/2017/06/2_The-Top-10-Secrets-of-Downtown-Brooklyn-in-NYC_Brooklyn-Bridge_Sunset_NYC_Untapped-Cities.v1.jpg'},tokyo:{name:'tokyo',id:1850147,preferredCard:'cardTokyo',longitude:139.691711,latitude:35.689499,colorSpectrum:['#BF360C','#F4511E'],coverImage:'https://www.telegraph.co.uk/content/dam/Travel/Destinations/Asia/Japan/Tokyo/Tokyo%20lead-xlarge.jpg'},santaMonica:{name:'santaMonica',id:5393212,preferredCard:'cardSantaMonica',longitude:-118.491188,latitude:34.019451,colorSpectrum:['#B71C1C','#EF5350'],coverImage:'https://www.santamonica.com/wp-content/uploads/2015/04/thumbnail_pier2.jpg'},amsterdam:{name:'amsterdam',id:2759794,preferredCard:'cardAmsterdam',longitude:4.88969,latitude:52.374031,colorSpectrum:['#880E4F','#EC407A'],coverImage:'http://www.netherlands-tourism.com/wp-content/uploads/2014/11/Amsterdam.jpg'},honolulu:{name:'honolulu',id:5856195,preferredCard:'cardHonolulu',longitude:-157.858337,latitude:21.30694,colorSpectrum:['#4a148c','#BA68C8'],coverImage:'https://travel.usnews.com/static-travel/images/destinations/59/waikiki_beach_honolulu.jpg'}},wW=1024,wH=768,cW=1024,cH=768,mainWeatherCondition={weatherId:800,isNight:!1},canvasAspectRatio=1.33,canvasObjectStorage={};$(document).ready(function(){for(city in $(window).resize(function(){wW=$(window).width(),wH=$(window).height(),700<wW?(canvasAspectRatio=3,$('#searchToggle').attr('disabled',!0),$('li.card').removeAttr('style')):(canvasAspectRatio=1.33,$('#searchToggle').attr('disabled',!1),$('li.card').width(wW)),cW=$('#cardHolder').width(),cH=cW/canvasAspectRatio,$('#canvasCurrentCity').attr({width:cW,height:cH}),setupAnimation()}).resize(),defaultLocations)$('body').hasClass('noAPI')?parseWeather(defaultLocations[city].name):getWeatherData(defaultLocations[city]);$('#searchToggle').on('click',function(a){a.preventDefault(),$('body').toggleClass('searchMode'),$('body').hasClass('searchMode')||window.requestAnimationFrame(function(){renderAnimation()})}),$('li.card').on('click',function(a){if(a.preventDefault(),$('body').hasClass('searchMode')||700<wW){let b=$('#cardBrooklyn').attr('city');parseWeather($(this).attr('city'),'cardBrooklyn'),parseWeather(b,$(this).attr('id')),$('body').removeClass('searchMode')}})});function setupAnimation(){let a=parseInt(mainWeatherCondition.weatherId/100);switch(canvasObjectStorage={},a){case 2:for(let f=0;2>f;f++){canvasObjectStorage[f]={},canvasObjectStorage[f].image=new Image,canvasObjectStorage[f].image.src=prepSVGPathForCanvas(vectors.thunder);let g=0.8*(cH/vectors.thunder.height);canvasObjectStorage[f].viewBox={x:0,y:0,w:vectors.thunder.width,h:vectors.thunder.height},canvasObjectStorage[f].targetViewBow={x:cW-1.1*(vectors.thunder.width*g),y:0,w:vectors.thunder.width*g,h:vectors.thunder.height*g},0==f&&(canvasObjectStorage[f].transformation={flash:!0})}break;case 3:case 5:case 6:let b=Math.floor(Math.random()*a)+2,c=2*Math.random()+1,d=6==a?vectors.snow:vectors.rain;for(let f=0;f<=b;f++){canvasObjectStorage[f]={},canvasObjectStorage[f].image=new Image,canvasObjectStorage[f].image.src=prepSVGPathForCanvas(d,{'path,polygon':{fill:'rgba(255, 255, 255, '+(0.25*Math.random()+0.1).toFixed(2)+')'}});let g=f==b?0.3*cH:0.2*Math.random()*cH+0.2*cH;canvasObjectStorage[f].viewBox={x:0,y:0,w:d.width,h:d.height},canvasObjectStorage[f].targetViewBow={x:f==b?0.6*cW:1.15*(Math.random()*cW)-0.15*cW,y:f==b?0.35*cH:Math.random()*cH-0.15*cH,w:g,h:g},canvasObjectStorage[f].transformation={add:{y:0.05*(c*Math.random())+0.97*c}}}break;case 7:for(let f=0;20>f;f++){canvasObjectStorage[f]={},canvasObjectStorage[f].image=new Image,canvasObjectStorage[f].image.src=prepSVGPathForCanvas(vectors.atmosphereBar,{'#bar':{fill:'rgba(255, 255, 255, '+(0.25*Math.random()+0.05).toFixed(2)+')'}});cW/vectors.atmosphereBar.width;canvasObjectStorage[f].viewBox={x:0,y:0,w:vectors.atmosphereBar.width,h:vectors.atmosphereBar.height},canvasObjectStorage[f].targetViewBow={x:-0.1*cW,y:cH-0.08*cH*f,w:1.2*cW,h:0.2*cH*Math.random()},canvasObjectStorage[f].transformation={opacity:{current:Math.random(),step:-0.01*Math.random(),min:0,max:0.5}}}break;case 8:if(800==mainWeatherCondition.weatherId){let f=0,g=mainWeatherCondition.isNight?vectors.moon:vectors.sun;canvasObjectStorage[f]={},canvasObjectStorage[f].image=new Image,canvasObjectStorage[f].image.src=prepSVGPathForCanvas(g);let h=0.5*(cH/g.height);canvasObjectStorage[f].viewBox={x:0,y:0,w:g.width,h:g.height},canvasObjectStorage[f].targetViewBow={x:cW-1.2*(g.width*h),y:0.1*cH,w:g.width*h,h:g.height*h},canvasObjectStorage[f].transformation={opacity:{current:1,step:-1e-3,min:0.92,max:1}}}else{let f=801==mainWeatherCondition.weatherId?1:5;for(let h,g=0;g<=f;g++){h=vectors['cloud'+(Math.floor(3*Math.random())+1)],canvasObjectStorage[g]={},canvasObjectStorage[g].image=new Image,canvasObjectStorage[g].image.src=prepSVGPathForCanvas(h);let j=0.5*(cH/h.height);0<g&&(j=j*Math.random()+0.5),canvasObjectStorage[g].viewBox={x:0,y:0,w:h.width,h:h.height},canvasObjectStorage[g].targetViewBow={x:0==g?cW-1.2*(h.width*j):0.5*(cW*Math.random()),y:0==g?0.1*cH:cH*Math.random()-0.25*cH,w:h.width*j,h:h.height*j},canvasObjectStorage[g].transformation={add:{x:2*Math.random()}}}}break;default:}window.requestAnimationFrame(function(){renderAnimation()})}function renderAnimation(){let a=document.getElementById('canvasCurrentCity');if(a){let b=a.getContext('2d');for(object in b.clearRect(0,0,cW,cH),canvasObjectStorage){for(newTransform in canvasObjectStorage[object].transformation){if('add'==newTransform){for(propType in canvasObjectStorage[object].transformation[newTransform])canvasObjectStorage[object].targetViewBow[propType]+=canvasObjectStorage[object].transformation[newTransform][propType];canvasObjectStorage[object].targetViewBow.y>cH?canvasObjectStorage[object].targetViewBow.y=-1*canvasObjectStorage[object].targetViewBow.h:canvasObjectStorage[object].targetViewBow.y<-1*canvasObjectStorage[object].targetViewBow.h&&(canvasObjectStorage[object].targetViewBow.y=cH),canvasObjectStorage[object].targetViewBow.x>cW?canvasObjectStorage[object].targetViewBow.x=-1*canvasObjectStorage[object].targetViewBow.w:canvasObjectStorage[object].targetViewBow.x<-1*canvasObjectStorage[object].targetViewBow.w&&(canvasObjectStorage[object].targetViewBow.x=cW)}if('flash'==newTransform){let c=0.05>Math.random()?1.2*(cH/canvasObjectStorage[object].viewBox.h)*Math.random():0;canvasObjectStorage[object].targetViewBow={x:cW*Math.random(),y:0,w:canvasObjectStorage[object].viewBox.w*c,h:canvasObjectStorage[object].viewBox.h*c}}'opacity'==newTransform&&(canvasObjectStorage[object].transformation[newTransform].current+=canvasObjectStorage[object].transformation[newTransform].step,canvasObjectStorage[object].transformation[newTransform].current>canvasObjectStorage[object].transformation[newTransform].max?(canvasObjectStorage[object].transformation[newTransform].step*=-1,canvasObjectStorage[object].transformation[newTransform].current=canvasObjectStorage[object].transformation[newTransform].max):canvasObjectStorage[object].transformation[newTransform].current<canvasObjectStorage[object].transformation[newTransform].min&&(canvasObjectStorage[object].transformation[newTransform].step*=-1,canvasObjectStorage[object].transformation[newTransform].current=canvasObjectStorage[object].transformation[newTransform].min),b.globalAlpha=canvasObjectStorage[object].transformation[newTransform].current)}b.drawImage(canvasObjectStorage[object].image,canvasObjectStorage[object].viewBox.x,canvasObjectStorage[object].viewBox.y,canvasObjectStorage[object].viewBox.w,canvasObjectStorage[object].viewBox.h,canvasObjectStorage[object].targetViewBow.x,canvasObjectStorage[object].targetViewBow.y,canvasObjectStorage[object].targetViewBow.w,canvasObjectStorage[object].targetViewBow.h),b.globalAlpha=1}window.requestAnimationFrame(function(){$('body').hasClass('searchMode')||renderAnimation()})}}function prepSVGPathForCanvas(a,b){let c='path, polygon { fill: rgba(255, 255, 255, 0.25); }';if('object'==typeof b)for(let d in b)if(b.hasOwnProperty(d)){for(let f in c+=d+'{',b[d])b[d].hasOwnProperty(f)&&(c+=f+':'+b[d][f]+';');c+='}'}return'data:image/svg+xml,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="'+a.width+'" height="'+a.height+'" viewBox="0 0 '+a.width+' '+a.height+'"><style type="text/css"><![CDATA[ '+c+'  ]]></style>'+a.path+'</svg>')}function parseWeather(a,b){let h,c=cityWeatherInfo[a],d=0,f=0,g=1,j=!1,k='',m=new Rainbow;for(let n in b=b||defaultLocations[a].preferredCard,m.setNumberRange(0,10),m.setSpectrum(defaultLocations[a].colorSpectrum[0],defaultLocations[a].colorSpectrum[1]),c.list){let o=c.list[n],p=new Date(1e3*o.dt),q={bgColor:'',classes:'',dateReadable:p.toString(),currentDay:p.getDay(),currentHour:p.getHours(),isNight:'',timestamp:'',currentTemp:Math.round(o.main.temp),weatherId:o.weather[0].id,weatherMain:o.weather[0].main,weatherDesc:o.weather[0].description};if(q.isNight=6<q.currentHour&&19>q.currentHour?!1:!0,0==d)h=q.currentDay,mainWeatherCondition={weatherId:q.weatherId,isNight:q.isNight},k='<div class="cardHeader"><h1>'+c.city.name+'</h1><span class="weather">'+findWeatherIcon(q)+'<span class=" weatherTemp">'+q.currentTemp+'<sup>\xB0</sup></span><h2 class="bigDesc">'+o.weather[0].description.replace(/\b\w/g,r=>r.toUpperCase())+'</h2></span></div>','cardBrooklyn'==b&&(k+='<canvas id="canvasCurrentCity" width="'+cW+'" height="'+cH+'" ></canvas><ul id="extendedForecast">'),f++;else if(5>d&&0<d)g=700<wW?3:g+1,q.bgColor='#'+m.colourAt(g),q.timestamp=prettyTime(q.currentHour),k+=generateExtendedForecastItem(q),f++;else if(h!=q.currentDay&&(j=!0,h=q.currentDay),!0==j&&12<=q.currentHour&&(g=700<wW?5:g+1,q.bgColor='#'+m.colourAt(g),q.timestamp=dayOfTheWeek(q.currentDay),k+=generateExtendedForecastItem(q),f++,j=!1,9==f))break;if(d++,'cardBrooklyn'!=b)break}'cardBrooklyn'==b&&(k+='</ul>'),$('#largeBgImage').css('backgroundImage','url("'+defaultLocations[a].coverImage+'")'),$('#'+b).html(k).css('background-color','#'+m.colourAt(0)).attr('city',a),'cardBrooklyn'==b&&setupAnimation()}function generateExtendedForecastItem(a){return'<li class="'+a.classes+'" style="background-color:'+a.bgColor+'"><div class="time">'+a.timestamp+'</div><div class="weather">'+findWeatherIcon(a)+'<span class="weatherTemp">'+a.currentTemp+'<sup>\xB0</sup> </span></div>'}function findWeatherIcon(a){let b='',c=parseInt(a.weatherId/100);switch(c){case 2:b+='thunder.png';break;case 3:case 5:b+='rain.png';break;case 6:b+='snow.png';break;case 7:b+='atmosphere.png';break;case 8:b+=800==a.weatherId?a.isNight?'clearN.png':'clear.png':801==a.weatherId?a.isNight?'partlyCloudyN.png':'partlyCloudy.png':'cloudy.png';break;default:b+=a.isNight?'clearN.png':'clear.png';}return'<img class="weatherIcon" src="img/'+b+'" alt="'+a.weatherDesc+'">'}function dayOfTheWeek(a){return 0===a?'Sunday':1===a?'Monday':2===a?'Tuesday':3===a?'Wednesday':4===a?'Thursday':5===a?'Friday':6===a?'Saturday':void 0}function prettyTime(a){return 12>a?(0==a&&(a=12),a+'AM'):a-12+'PM'}function getWeatherData(a){$.ajax({method:'GET',url:'http://api.openweathermap.org/data/2.5/forecast',data:{id:a.id,mode:'json',APPID:'c5e0b01bf32a03207f66c5b14301fe45',units:'imperial'},success:function(b){200==b.cod&&(cityWeatherInfo[a.name]=b)},error:function(b){console.log('Error!'+b.status)},complete:function(){parseWeather(a.name,a.preferredCard)},dataType:'json'})}function geo_success(a){currentLocation.longitude=a.coords.longitude,currentLocation.latitude=a.coords.latitude,getWeatherData()}function geo_error(a){currentLocation=defaultLocations.Brooklyn,console.log('ERROR('+a.code+'): '+a.message),getWeatherData()}